<ng-container *ngIf="dataset; else loadingDataset;">

<div class="row">
  <div class="col-md-8">
    <h1>{{ dataset.prefLabel | lang }}</h1>
  </div>

  <div class="col-md-4">
    <h2>
      <ng-container *ngIf="dataset.published; else unpublished;">
          <span class="label label-success">
          {{ 'published' | translate }}
          <span class="glyphicon glyphicon-ok"></span>
        </span>
        <button (click)="confirmUnpublish()" class="btn btn-warning btn-unpublish">
          {{ 'unpublish' | translate }}
        </button>
      </ng-container>
      <ng-template #unpublished>
        <span class="label label-default">
          {{ 'unpublished' | translate }}
        </span>
        <button (click)="confirmPublish()" class="btn btn-warning btn-publish">
          {{ 'publish' | translate }}
        </button>
      </ng-template>
    </h2>
  </div>
</div>

<div class="row">
  <div class="col-xs-12">

    <h2>{{ 'altLabel' | translate }}</h2>
    <p>{{ dataset.altLabel | lang }}</p>

    <h2>{{ 'description' | translate }}</h2>
    <p class="preserve-line-breaks">{{ dataset.description | lang }}</p>

    <h2>{{ 'abbreviation' | translate }}</h2>
    <p>{{ dataset.abbreviation | lang }}</p>

    <h2>{{ 'organization' | translate }}</h2>
    <p *ngIf="dataset.owner">
      {{ dataset.owner.prefLabel | lang }}
      <span *ngIf="dataset.owner.abbreviation | lang">
          ({{ dataset.owner.abbreviation | lang }})
      </span>
    </p>

    <h2>{{ 'organizationUnit' | translate }}</h2>
    <p *ngFor="let ownerOrganizationUnit of dataset.ownerOrganizationUnit">
        {{ ownerOrganizationUnit.prefLabel | lang }}
        <span *ngIf="ownerOrganizationUnit.abbreviation | lang">
          ({{ ownerOrganizationUnit.abbreviation | lang }})
      </span>
    </p>

    <h2>{{ 'links' | translate }}</h2>
    <ul>
      <li *ngFor="let link of dataset.links">
        <a href="{{ link.linkUrl | lang }}" target="_blank">
          {{ link.prefLabel | lang }}
        </a>
      </li>
    </ul>

    <h2>{{ 'registryPolicy' | translate }}</h2>
    <p class="preserve-line-breaks">{{ dataset.registryPolicy | lang }}</p>

    <h2>{{ 'usageCondition' | translate }}</h2>
    <p *ngIf="dataset.usageCondition && (dataset.usageCondition.prefLabel | lang)">
      {{ dataset.usageCondition.prefLabel | lang }}
    </p>

    <h2>{{ 'usageConditionAdditionalInformation' | translate }}</h2>
    <p class="preserve-line-breaks">{{ dataset.usageConditionAdditionalInformation | lang }}</p>

    <h2 translate="numberOfObservationUnits"></h2>
    <p>{{dataset.numberOfObservationUnits}}</p>

    <ng-container *ngIf="dataset.unitType">
      <h2 translate="unitType"></h2>
      <p>{{dataset.unitType.prefLabel | lang}}</p>
    </ng-container>

    <ng-container *ngIf="dataset.population">

      <h2>{{ 'population' | translate }}</h2>
      <p>{{ dataset.population.prefLabel | lang }}</p>

      <h2>{{ 'geographicalCoverage' | translate }}</h2>
      <p>{{ dataset.population.geographicalCoverage | lang }}</p>


      <h2>{{ 'sampleSize' | translate }}</h2>
      <p>{{ dataset.population.sampleSize | lang }}</p>

      <h2>{{ 'loss' | translate }}</h2>
      <p>{{ dataset.population.loss | lang }}</p>

    </ng-container>

    <ng-container *ngIf="(dataset.datasetTypes && dataset.datasetTypes.length)">

      <h2>{{ 'datasetType' | translate }}</h2>
      <p *ngFor="let datasetType of dataset.datasetTypes">{{datasetType.prefLabel | lang }}</p>

    </ng-container>

    <h2>{{ 'referencePeriod' | translate }}</h2>
    <p *ngIf="dataset.referencePeriodStart || dataset.referencePeriodEnd; else noReferencePeriod;">
      <ng-container *ngIf="dataset.referencePeriodStart">
        {{ dataset.referencePeriodStart }}
      </ng-container>
      —
      <ng-container *ngIf="dataset.referencePeriodEnd">
        {{ dataset.referencePeriodEnd }}
      </ng-container>
    </p>
    <ng-template #noReferencePeriod>
      <p>{{ 'noReferencePeriod' | translate }}</p>
    </ng-template>

    <ng-container *ngIf="dataset.lifecyclePhase">

      <h2>{{ 'lifecyclePhase' | translate }}</h2>
      <p>{{ dataset.lifecyclePhase.prefLabel | lang }}</p>

    </ng-container>

    <h2>{{ 'conceptsFromScheme' | translate }}</h2>

    <p *ngIf="dataset.conceptsFromScheme.length; else noConceptsFromScheme;">
      <span *ngFor="let concept of dataset.conceptsFromScheme"
        style="margin-right:.6em;">
        {{ concept.prefLabel | lang }}
        <span style="opacity:.6">
          ({{ concept.conceptScheme.prefLabel | lang }})
        </span>
      </span>
    </p>

    <ng-template #noConceptsFromScheme>
      <p>{{ 'noConceptsFromScheme' | translate }}</p>
    </ng-template>

    <h2>{{ 'freeConcepts' | translate }}</h2>

    <p *ngIf="dataset.freeConcepts && dataset.freeConcepts[language]; else noFreeConcepts;">
      <span *ngFor="let concept of dataset.freeConcepts[language].split(';')"
            style="margin-right:1em;">
        {{ concept.trim() }}
      </span>
    </p>

    <ng-template #noFreeConcepts>
      <p>{{ 'noFreeConcepts' | translate }}</p>
    </ng-template>

    <ng-container *ngIf="dataset.comment">
      <h2>{{ 'comment' | translate }}</h2>
      <p>{{ dataset.comment}}</p>
    </ng-container>

  </div>
</div>

<div class="row">
  <div class="col-xs-12">
    <h2>{{ 'instanceVariables' | translate }}</h2>

    <table *ngIf="(dataset.instanceVariables && dataset.instanceVariables.length); else noInstanceVariables;"
        class="table table-striped table-hover">
        <tr>
        <th>{{ 'prefLabel' | translate }}</th>
        <th>{{ 'description' | translate }}</th>
        <th>{{ 'referencePeriod' | translate }}</th>
        <th>{{ 'functions' | translate }}</th>
      </tr>
      <tr *ngFor="let variable of dataset.instanceVariables"
        routerLink="/editor/datasets/{{ dataset.id }}/instanceVariables/{{ variable.id }}">
        <td>
          <a routerLink="/editor/datasets/{{ dataset.id }}/instanceVariables/{{ variable.id }}">{{ variable.prefLabel | lang }}</a>
        </td>
        <td>
          <span class="preserve-line-breaks">{{ variable.description | lang }}</span>
        </td>
        <td>
          <ng-container *ngIf="(variable.referencePeriodStart || variable.referencePeriodEnd); else inheritedReferencePeriod;">
            <em>
              {{ variable.referencePeriodStart }}
              —
              {{ variable.referencePeriodEnd }}
            </em>
          </ng-container>
          <ng-template #inheritedReferencePeriod>
            <ng-container *ngIf="(dataset.referencePeriodStart || dataset.referencePeriodEnd)">
              {{ dataset.referencePeriodStart }}
              —
              {{ dataset.referencePeriodEnd }}
            </ng-container>
          </ng-template>
        </td>
        <td>
          <button routerLink="/editor/datasets/{{ dataset.id }}/instanceVariables/{{ variable.id }}/edit"
                  class="btn btn-default btn-sm">
            <span class="glyphicon glyphicon-edit"></span>
            {{ 'edit' | translate }}
          </button>
        </td>
      </tr>
    </table>

    <ng-template #noInstanceVariables>
      <p>{{ 'noInstanceVariables' | translate }}</p>
    </ng-template>

    <button routerLink="/editor/datasets/{{ dataset.id }}/instanceVariables/new"
            class="btn btn-default">
      <span class="glyphicon glyphicon-plus"></span>
      {{ 'addInstanceVariable' | translate }}
    </button>

    <button (click)="showImportInstanceVariablesModal()"
      class="btn btn-default pull-right">
      <i class="fa fa-upload" aria-hidden="true"></i>
      {{ 'importInstanceVariablesAsCsvButton' | translate }}
    </button>
  </div>
</div>

<instance-variables-import-modal
  [dataset]="datasetForImportInstanceVariablesModal"
  (onImport)="getDataSet(); closeImportInstanceVariablesModal()"
  (onCancel)="closeImportInstanceVariablesModal()">
</instance-variables-import-modal>

</ng-container>

<ng-template #loadingDataset>
  <thl-spinner></thl-spinner>
</ng-template>

<div class="row">
  <div class="col-xs-12">
    <hr>
  </div>
</div>

<div class="row">
  <div class="col-xs-12">
    <button routerLink="/editor/datasets" class="btn btn-default">
      <span class="glyphicon glyphicon-chevron-left"></span>
      {{ 'back' | translate }}
    </button>
    <button *ngIf="dataset"
        routerLink="/editor/datasets/{{ dataset.id }}/edit"
        class="btn btn-default">
      <span class="glyphicon glyphicon-edit"></span>
      {{ 'edit' | translate }}
    </button>
  </div>
</div>

