<ng-container *ngIf="instanceVariable; else loadingInstanceVariable;">

  <study-sidebar [study]="study"
                 [activeSection]="sidebarActiveSection">
  </study-sidebar>

  <div class="content-container">

    <div class="content-header container-fluid">
      <div class="row">
        <div class="col-xs-12">
          <h1>{{ instanceVariable.prefLabel | lang }}</h1>
        </div>
      </div>
<!-- TODO: Uncomment when lastModifiedDate has been added to instance variable.
      <div class="row">
        <div class="col-xs-12">
          <small>{{'lastModified' | translate}}: {{ instanceVariable.lastModifiedDate | date:'dd.MM.yyyy HH:mm' }}</small>
        </div>
      </div>
-->
    </div>

    <div class="content-body container-fluid">

      <div class="row">
        <div class="col-xs-12">
          <button *ngIf="instanceVariable"
                  routerLink="/editor/studies/{{ study.id }}/datasets/{{ dataset.id }}/instanceVariables/{{ instanceVariable.id }}/edit"
                  class="btn btn-default pull-right">
            <span class="glyphicon glyphicon-pencil"></span>
            {{ 'edit' | translate }}
          </button>
        </div>
      </div>

      <div *ngIf="instanceVariable.variable"
           class="row">
        <div class="col-xs-12">
          <h2>{{ 'variable' | translate }}</h2>
          <p>{{ instanceVariable.variable.prefLabel | lang }}</p>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-12">
          <h2>{{ 'technicalName' | translate }}</h2>
          <p>{{ instanceVariable.technicalName }}</p>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-12">
          <h2>{{ 'description' | translate }}</h2>
          <p class="preserve-line-breaks">{{ instanceVariable.description | lang }}</p>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-12">
          <h2>{{ 'partOfGroup' | translate }}</h2>
          <p>{{ instanceVariable.partOfGroup | lang }}</p>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-12">
          <h2>{{ 'conceptsFromScheme' | translate }}</h2>
          <p *ngIf="instanceVariable.conceptsFromScheme.length; else noConceptsFromScheme;">
            <span *ngFor="let concept of instanceVariable.conceptsFromScheme"
                  style="margin-right:.6em;">
              {{ concept.prefLabel | lang }}
              <span style="opacity:.6">
                ({{ concept.conceptScheme.prefLabel | lang }})
              </span>
            </span>
          </p>
          <ng-template #noConceptsFromScheme>
            <p>{{ 'noConceptsFromScheme' | translate }}</p>
          </ng-template>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-12">
          <h2>{{ 'freeConcepts' | translate }}</h2>
          <p *ngIf="instanceVariable.freeConcepts && instanceVariable.freeConcepts[language]; else noFreeConcepts;">
            <span *ngFor="let concept of instanceVariable.freeConcepts[language].split(';')"
                  style="margin-right:1em;">
              {{ concept.trim() }}
            </span>
          </p>
          <ng-template #noFreeConcepts>
            <p>{{ 'noFreeConcepts' | translate }}</p>
          </ng-template>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-12">
          <h2>{{ 'referencePeriod' | translate }}</h2>
          <ng-container *ngIf="(instanceVariable.referencePeriodStart || instanceVariable.referencePeriodEnd); else datasetReferencePeriod;">
            <p>
              {{ instanceVariable.referencePeriodStart | date:'dd.MM.yyyy' }}
              —
              {{ instanceVariable.referencePeriodEnd | date:'dd.MM.yyyy' }}
              <span style="margin-left:2em;opacity:.6;">
                <ng-container *ngIf="(dataset.referencePeriodStart || dataset.referencePeriodEnd); else valueInStudy;">
                  <i class="fa fa-exclamation-circle" aria-hidden="true"></i>
                  {{ 'valueInDataset' | translate }}:
                  {{ dataset.referencePeriodStart | date:'dd.MM.yyyy' }}
                  —
                  {{ dataset.referencePeriodEnd | date:'dd.MM.yyyy' }}
                </ng-container>
                <ng-template #valueInStudy>
                  <ng-container *ngIf="(study.referencePeriodStart || study.referencePeriodEnd)">
                    <i class="fa fa-exclamation-circle" aria-hidden="true"></i>
                    {{ 'valueInStudy' | translate }}:
                    {{ study.referencePeriodStart | date:'dd.MM.yyyy' }}
                    —
                    {{ study.referencePeriodEnd | date:'dd.MM.yyyy' }}
                  </ng-container>
                </ng-template>
              </span>
            </p>
          </ng-container>
          <ng-template #datasetReferencePeriod>
            <ng-container *ngIf="(dataset.referencePeriodStart || dataset.referencePeriodEnd); else studyReferencePeriod;">
              <p>
                {{ dataset.referencePeriodStart | date:'dd.MM.yyyy' }}
                —
                {{ dataset.referencePeriodEnd | date:'dd.MM.yyyy' }}
                <span style="margin-left:2em;opacity:.6;">
                  <i class="fa fa-info-circle" aria-hidden="true"></i>
                  {{ 'inheritedFromDataset' | translate }}
                </span>
              </p>
            </ng-container>
          </ng-template>
          <ng-template #studyReferencePeriod>
            <p *ngIf="(study.referencePeriodStart || study.referencePeriodEnd)">
              {{ study.referencePeriodStart | date:'dd.MM.yyyy' }}
              —
              {{ study.referencePeriodEnd | date:'dd.MM.yyyy' }}
              <span style="margin-left:2em;opacity:.6;">
                <i class="fa fa-info-circle" aria-hidden="true"></i>
                {{ 'inheritedFromStudy' | translate }}
              </span>
            </p>
          </ng-template>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-12">
          <h2>{{ 'valueDomainType.label' | translate }}</h2>
          <p *ngIf="instanceVariable.valueDomainType">
            {{ 'valueDomainType.' + instanceVariable.valueDomainType | translate }}
          </p>
        </div>
      </div>

      <ng-container *ngIf="instanceVariable.valueDomainType == 'described'">
        <div class="row">
          <div class="col-xs-12">
            <h2>{{ 'quantity' | translate }}</h2>
            <p *ngIf="instanceVariable.quantity; else noUnit;">
              {{ instanceVariable.quantity.prefLabel | lang }}
            </p>
            <ng-template #noUnit>
              <p>{{ 'noQuantity' | translate }}</p>
            </ng-template>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12">
            <h2>{{ 'unit' | translate }}</h2>
            <p *ngIf="instanceVariable.unit; else noUnit;">
              {{ instanceVariable.unit.prefLabel | lang }}
              <span *ngIf="instanceVariable.unit.symbol | lang">
            ({{ instanceVariable.unit.symbol | lang }})
          </span>
            </p>
            <ng-template #noUnit>
              <p>{{ 'noUnit' | translate }}</p>
            </ng-template>
          </div>
        </div>
      </ng-container>

      <div *ngIf="instanceVariable.valueDomainType == 'enumerated'"
           class="row">
        <div class="col-xs-12">
          <h2>{{ 'codeList.label' | translate }}</h2>
          <ng-container *ngIf="instanceVariable.codeList; else noCodeList;">
            <p>
              <strong>{{ instanceVariable.codeList.prefLabel | lang }}</strong>
              <span *ngIf="instanceVariable.codeList.referenceId"
                    style="opacity:.7">
          ({{ instanceVariable.codeList.referenceId }})
        </span>
            </p>
            <p *ngIf="instanceVariable.codeList.description | lang"
               class="preserve-line-breaks">{{ instanceVariable.codeList.description | lang }}</p>
            <p *ngIf="instanceVariable.codeList.owner | lang" >
              <em>
                {{ 'codeList.owner' | translate }}:
                {{ instanceVariable.codeList.owner | lang }}
              </em>
            </p>
            <div *ngIf="instanceVariable.codeList.codeItems.length">
              <button (click)="viewCodeListCodeItemsModal.toggle()"
                      class="btn btn-default btn-sm">
                <i class="fa fa-eye" aria-hidden="true"></i>
                {{ 'viewCodeItems' | translate }}
              </button>
              <viewCodeListCodeItemsModal
                #viewCodeListCodeItemsModal
                [codeList]="instanceVariable.codeList">
              </viewCodeListCodeItemsModal>
            </div>
          </ng-container>
          <ng-template #noCodeList>
            <p>{{ 'noCodeList' | translate }}</p>
          </ng-template>
        </div>
      </div>

      <div *ngIf="instanceVariable.valueRangeMin !== undefined"
           class="row">
        <div class="col-xs-12">
          <h2>{{'valueRangeMin'|translate}}</h2>
          <p>{{ instanceVariable.valueRangeMin }}</p>
        </div>
      </div>

      <div *ngIf="instanceVariable.valueRangeMax !== undefined"
           class="row">
        <div class="col-xs-12">
          <h2>{{'valueRangeMax'|translate}}</h2>
          <p>{{ instanceVariable.valueRangeMax }}</p>
        </div>
      </div>

      <div *ngIf="instanceVariable.missingValues && instanceVariable.missingValues[language]"
           class="row">
        <div class="col-xs-12">
          <h2>{{'missingValues'|translate}}</h2>
          <p class="preserve-line-breaks">{{ instanceVariable.missingValues | lang }}</p>
        </div>
      </div>

      <div *ngIf="instanceVariable.defaultMissingValue" class="row">
        <div class="col-xs-12">
          <h2>{{'defaultMissingValue'|translate}}</h2>
          <p>{{ instanceVariable.defaultMissingValue }}</p>
        </div>
      </div>

      <div *ngIf="instanceVariable.qualityStatement | lang" class="row">
        <div class="col-xs-12">
          <h2>{{'qualityStatement'|translate}}</h2>
          <p class="preserve-line-breaks">{{ instanceVariable.qualityStatement | lang }}</p>
        </div>
      </div>

      <div *ngIf="instanceVariable.source || (instanceVariable.sourceDescription | lang)"
           class="row">
        <div class="col-xs-12">
          <h2>{{ 'instanceVariableSource' | translate }}</h2>
          <p *ngIf="instanceVariable.source">
            {{ instanceVariable.source.prefLabel | lang }}
          </p>
          <p *ngIf="instanceVariable.sourceDescription && (instanceVariable.sourceDescription | lang)">
            {{ instanceVariable.sourceDescription | lang }}
          </p>
        </div>
      </div>

      <div *ngIf="instanceVariable.dataType" class="row">
        <div class="col-xs-12">
          <h2>{{ 'dataType' | translate }}</h2>
          <p>{{ instanceVariable.dataType }}</p>
        </div>
      </div>

      <div *ngIf="instanceVariable.dataFormat | lang" class="row">
        <div class="col-xs-12">
          <h2>{{'dataFormat' | translate}}</h2>
          <p>{{ instanceVariable.dataFormat | lang }}</p>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-12">
          <h2>{{ 'unitType' | translate }}</h2>
          <p>
            <ng-container *ngIf="instanceVariable.unitType; else unitTypeFromDataset;">
              {{ instanceVariable.unitType.prefLabel | lang }}
              <span *ngIf="dataset.unitType && dataset.unitType.id != instanceVariable.unitType.id"
                    style="margin-left:2em;">
                <i class="fa fa-exclamation-circle" aria-hidden="true"></i>
                {{ 'valueInDataset' | translate }}:
                {{ dataset.unitType.prefLabel | lang }}
              </span>
            </ng-container>
            <ng-template #unitTypeFromDataset>
              <ng-container *ngIf="dataset.unitType; else unitTypeFromStudy;">
                {{ dataset.unitType.prefLabel | lang }}
                <span style="margin-left:2em;opacity:.6;">
                  <i class="fa fa-info-circle" aria-hidden="true"></i>
                  {{ 'inheritedFromDataset' | translate }}
                </span>
              </ng-container>
            </ng-template>
            <ng-template #unitTypeFromStudy>
              <ng-container *ngIf="study.unitType">
                {{ study.unitType.prefLabel | lang }}
                <span style="margin-left:2em;opacity:.6;">
                  <i class="fa fa-info-circle" aria-hidden="true"></i>
                  {{ 'inheritedFromStudy' | translate }}
                </span>
              </ng-container>
            </ng-template>
          </p>
        </div>
      </div>

      <div *ngIf="instanceVariable.instanceQuestions.length"
           class="row">
        <div class="col-xs-12">
          <h2>{{ 'instanceQuestions' | translate }}</h2>
          <ul>
            <li class="preserve-line-breaks" *ngFor="let question of instanceVariable.instanceQuestions">{{ question.prefLabel | lang }}</li>
          </ul>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-12">
          <button *ngIf="instanceVariable"
                  routerLink="/editor/studies/{{ study.id }}/datasets/{{ dataset.id }}/instanceVariables/{{ instanceVariable.id }}/edit"
                  class="btn btn-default pull-right">
            <span class="glyphicon glyphicon-pencil"></span>
            {{ 'edit' | translate }}
          </button>
        </div>
      </div>

    </div>

  </div>

</ng-container>

<ng-template #loadingInstanceVariable>
  <thl-spinner></thl-spinner>
</ng-template>
